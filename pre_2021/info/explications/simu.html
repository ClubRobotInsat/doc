<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Architecture du simulateur - Documentation Club Robot Insa Toulouse</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation Club Robot Insa Toulouse</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="architecture-du-simulateur"><a class="header" href="#architecture-du-simulateur">Architecture du simulateur</a></h1>
<p>Le simulateur est fait pour être modulaire, c'est à dire que l'on peut passer d'une solution graphique à une autre et on peut rajouter des modules pour le robot facilement.</p>
<p>Il y a 5 composantes principales :</p>
<ul>
<li>La  <a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/physique/"><code>physique/</code></a> permet de simuler le comportement de tous les objets physiquement
en prenant en compte les collisions, les déplacements etc. Pour ce faire, on utilise la librairie <a href="http://box2d.org/">Box2D</a>, un moteur physique.</li>
<li>Le  <a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/graphique/"><code>graphique/</code></a> permet d'afficher tous les objets de la table dans un environnement
3D avec la possibilité de s'y déplacer, de zoomer ... Ici encore, on utilise une librairie, <a href="http://irrlicht.sourceforge.net/">Irrlicht</a>, en tant que moteur graphique.</li>
<li>La <a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/gui/"><code>gui/</code></a> gère l'interface utilisateur, affiche des informations utiles (telles que l'état
du robot par exemple) et permet de piloter le simulateur.</li>
<li>La <a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/communication/"><code>communication/</code></a> permets de simuler le comportement des cartes électroniques.
On peut donc utiliser la même stratégie en réel et sur le simulateur qui demande au robot d'<code>avancer</code> de 10 cm par exemple, et l'application va simuler les actions.</li>
<li>Le <a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/core/"><code>core/</code></a> permets enfin de tout coordonner pour avoir un simulateur fonctionnel.</li>
</ul>
<h2 id="coeur"><a class="header" href="#coeur">Coeur</a></h2>
<p>Le simulateur est entièrement controllé par la classe <a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/core/Simulateur.h"><code>Simulateur</code></a>.
Cette classe est instanciée directement dans le <code>main</code> et contrôle les différents modules. Elle contient des méthodes pour initialiser le simulateur,
reset la table, ajouter des robots à la simulation, et terminer proprement une session.</p>
<p>La classe <code>Simulateur</code> contient une instance de <code>World</code>.</p>
<h2 id="communication"><a class="header" href="#communication">Communication</a></h2>
<p>La communication du simulateur fonctionne en mirroir de celle de l'IA. Le code a donc plus ou moins la même structure : plusieurs modules, rassemblés dans un <code>ModuleManager</code>,
et un communicator pour gérer l'envoi des trames.</p>
<p>Le simulateur implémente ses propres modules spécifiques, qui jouent le rôle des cartes dans le robot réel. Ces modules fonctionnent exactement sur le même principe que les
modules côté IA : ils reçoivent des trames, les lisent, effectuent des actions et envoient de nouvelles trames en réponse.</p>
<p>Le simulateur jouant le rôle des cartes du robot, il envoit une trame seulement en réponse à une trame de la partie informatique. Ce comportement est implémenté dans la méthode
<code>communicationThread()</code> du <a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/communication/SimuCommunicator.cpp"><code>SimuCommunicator</code></a>.</p>
<h2 id="partie-physique"><a class="header" href="#partie-physique">Partie physique</a></h2>
<p>L'API de la partie physique est constituées de deux interfaces :
<a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/physique/IPhysicalContext.h"><code>IPhysicalContext</code></a>, qui permet de créer des objets dans le moteur physique
et <a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/physique/IPhysicalInstance.h"><code>IPhysicalInstance</code></a>, qui permet de gérer un objet physique en
particulier.</p>
<p>Le coeur du simulateur ne manipule que ces interfaces, et n'a pas besoin de savoir comment c'est implémenté derrière. L'utilisation d'interfaces de cette manière permet le
<strong>découplage</strong> des différentes parties du simulateur. Pour plus d'information sur le couplage des composants logiciels d'une application, voici un lien vers
<a href="https://fr.wikipedia.org/wiki/Couplage_(informatique)">la page Wikipedia</a></p>
<h3 id="implémentation"><a class="header" href="#implémentation">Implémentation</a></h3>
<p>L'implementation du moteur physique du simulateur est réalisée à l'aide du moteur physique <a href="https://box2d.org/">Box2D</a>. Elle se situe dans le dossier
<a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/physique/box2D/"><code>physique/box2D/</code></a>.</p>
<p>Il y a quelques années, le simulateur utilisait un moteur physique en 3D. Même si les simulations étaient plus réalistes, il était difficile de configurer l'environnement
pour que le robot se comporte comme en vrai. C'est pourquoi nous sommes passés à un moteur en 2D.</p>
<h2 id="partie-graphique"><a class="header" href="#partie-graphique">Partie graphique</a></h2>
<p>De même que la partie physique, la partie graphique du simulateur est manipulée via deux interfaces,
<a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/graphique/IGraphicalContext.h"><code>IGraphicalContext</code></a> pour créer les objets 3D de l'affichage
et <a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/graphique/IGraphicalInstance.h"><code>IGraphicalInstance</code></a> pour modifier les propriétés d'un
objet en particulier.</p>
<h3 id="implémentation-1"><a class="header" href="#implémentation-1">Implémentation</a></h3>
<p>Nous utilisons <a href="http://irrlicht.sourceforge.net/">Irrlicht</a> pour l'implémentation de l'affichage graphique de la simulation. Celle-ci se trouve dans le dossier
<a href="https://github.com/ClubRobotInsat/info/tree/develop/src/simulateur/graphique/irrlicht/"><code>graphique/irrlicht/</code></a>.</p>
<h2 id="interface-utilisateur-gui"><a class="header" href="#interface-utilisateur-gui">Interface utilisateur (GUI)</a></h2>
<p>Pour pouvoir interagir avec le simulateur, il faut des boutons, des champs de texte, etc. Ces fonctionnalités sont assez différentes de l'affichage 3D du simulateur.
De plus, Irrlicht ne nous permet pas de rajouter facilement des éléments d'UI (User Interface) à l'affichage 3D. La GUI est donc un module séparé de l'affichage 3D.
Le coeur du simulateur interagit avec ce module à travers l'interface <a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/gui/IGuiContext.h"><code>IGuiContext</code></a>.</p>
<p>Le module doit aussi transmettre les ordres de l'utilisateur au simulateur. Pour se faire, il reçoit lors de son initialisation un objet de type
<a href="https://github.com/ClubRobotInsat/info/blob/develop/src/simulateur/gui/IGuiClient.h"><code>IGuiClient</code></a>, qui possède des méthodes permettant d'éxecuter des actions
sur le simulateur.</p>
<h3 id="implémentation-2"><a class="header" href="#implémentation-2">Implémentation</a></h3>
<p>La librarie utilisée pour la GUI se nomme <a href="https://www.gtkmm.org/en/">Gtkmm</a>. C'est un port C++ de la librairie C <em>Gtk</em> utilisée dans de nombreuses programmes comportant
une interface graphique. Vous pourrez trouver une doc très détaillée de Gtkmm
<a href="https://developer.gnome.org/gtkmm-tutorial/unstable/gtkmm-tutorial.html">ici</a>.</p>
<p>La GUI se compose actuellement d'une fenêtre comportant plusieurs panneaux. Les panneaux sont créés avec <a href="https://glade.gnome.org/">Glade</a>. Ils sont sauvegardés dans
le dossier <code>gui/gtk/glade/</code> sous forme de fichiers <code>.glade</code>. A la création de la fenêtre, le simulateur charge ces différents panneaux et les ajoute à la fenêtre
principale. Comme ça le placement des composants est déjà fait, il ne reste plus qu'à écrire le code qui exécute l'action demandée par l'utilisateur.</p>
<p>Les différentes classes qui gèrent les panneaux ont toutes un nom de la forme <code>Panel[Nom du panneau].h/.cpp</code>. Le <code>PanelConnect</code> est un bon exemple si vous voulez implémenter
votre propre panneau !</p>
<h2 id="complément-sur-le-couplage-"><a class="header" href="#complément-sur-le-couplage-">Complément sur le couplage :)</a></h2>
<pre><code>Section à rédiger
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../pre_2021/info/explications/robot.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../pre_2021/elec_soft/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../pre_2021/info/explications/robot.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../pre_2021/elec_soft/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
